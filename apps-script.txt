
/*
  Google Apps Script Web App to receive JSON via POST and append to a Google Sheet.
  Steps to deploy:
  1. Create a new Google Sheet.
  2. Rename Sheet1 to "Leads" (or update SHEET_NAME below).
  3. Open Extensions → Apps Script in the spreadsheet.
  4. Replace the code with this script and save.
  5. Deploy → New deployment → Select 'Web app' → Execute as: Me, Who has access: Anyone.
  6. Copy the web app URL and paste into APPS_SCRIPT_ENDPOINT in script.js.
*/

const SHEET_NAME = 'Leads'; // sheet tab name

function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName(SHEET_NAME) || ss.getSheets()[0];
    const data = JSON.parse(e.postData.contents);
    const row = [
      new Date(), // received timestamp
      data.name || '',
      data.phone || '',
      data.service || '',
      data.message || '',
      data.timestamp || ''
    ];
    sheet.appendRow(row);
    return ContentService.createTextOutput(JSON.stringify({status: 'success'})).setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({status: 'error', message: err.message})).setMimeType(ContentService.MimeType.JSON);
  }
}

// Optional: set up headers row
function setupHeaders() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName(SHEET_NAME) || ss.getSheets()[0];
  sheet.clear();
  sheet.appendRow(['Received At', 'Name', 'Phone', 'Service', 'Message', 'Client Timestamp']);
}
